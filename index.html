<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Live mNAV Dashboard — BMNR & SBET</title>
    <style>
      /* Base styles for page structure */
      body {
        margin: 0;
        font-family: Arial, Helvetica, sans-serif;
        background: #f7f7f7;
        color: #333;
        line-height: 1.6;
      }

      header {
        background: linear-gradient(135deg, #4b6cb7, #182848);
        color: #fff;
        padding: 2rem 1rem;
        text-align: center;
      }
      header h1 {
        margin: 0;
        font-size: 2.5rem;
      }
      header p {
        margin-top: 0.5rem;
        font-size: 1.1rem;
        opacity: 0.8;
      }

      .container {
        max-width: 960px;
        margin: 2rem auto;
        padding: 0 1rem;
      }

      .card {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
        padding: 1.5rem;
      }

      .card h2 {
        margin-top: 0;
        color: #2c3e50;
      }

      .metrics {
        display: flex;
        flex-wrap: wrap;
        margin-top: 0.5rem;
      }
      .metric {
        flex: 1 1 250px;
        margin: 0.5rem 0;
        padding: 0.5rem;
      }
      .metric h3 {
        margin: 0;
        font-size: 1.1rem;
        color: #555;
      }
      .metric span {
        display: block;
        font-size: 1.5rem;
        font-weight: bold;
        margin-top: 0.25rem;
      }

      .disclaimer {
        font-size: 0.9rem;
        color: #777;
        margin-top: 1rem;
      }

      footer {
        text-align: center;
        padding: 1rem 0;
        color: #777;
        font-size: 0.9rem;
      }

      /* Responsive adjustments */
      @media (max-width: 600px) {
        header h1 {
          font-size: 2rem;
        }
        .metric span {
          font-size: 1.2rem;
        }
      }

      /* Refresh button styling */
      #refresh-button {
        display: inline-block;
        margin-top: 1rem;
        padding: 0.5rem 1rem;
        background: #4b6cb7;
        color: #fff;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        font-size: 1rem;
      }
      #refresh-button:hover {
        background: #365a96;
      }
    </style>
  </head>
  <body>
    <header>
      <h1>Live mNAV Dashboard</h1>
      <p>Market Cap to Net Asset Value (mNAV) ratios for Ethereum treasury stocks</p>
    </header>
    <div class="container">
      <!-- BMNR card -->
      <div class="card" id="bmnr-card">
        <h2>BitMine Immersion Technologies (BMNR)</h2>
        <div class="metrics">
          <div class="metric">
            <h3>mNAV</h3>
            <span id="bmnr-mnav">—</span>
          </div>
          <div class="metric">
            <h3>Share price</h3>
            <span id="bmnr-price">—</span>
          </div>
          <div class="metric">
            <h3>ETH holdings</h3>
            <span id="bmnr-eth">—</span>
          </div>
        </div>
        <div class="disclaimer">
          Values reflect the latest available data as of 19 August 2025. BMNR’s mNAV approximates the ratio of its market capitalisation to the market value of its Ethereum treasury【435112548905025†L64-L67】.
        </div>
      </div>

      <!-- SBET card -->
      <div class="card" id="sbet-card">
        <h2>SharpLink Gaming (SBET)</h2>
        <div class="metrics">
          <div class="metric">
            <h3>mNAV</h3>
            <span id="sbet-mnav">—</span>
          </div>
          <div class="metric">
            <h3>Share price</h3>
            <span id="sbet-price">—</span>
          </div>
          <div class="metric">
            <h3>ETH holdings</h3>
            <span id="sbet-eth">—</span>
          </div>
        </div>
        <div class="disclaimer">
          Values reflect the latest available data as of 19 August 2025. SBET’s mNAV is derived from its market capitalisation and the value of its Ethereum holdings【435112548905025†L64-L67】.
        </div>
      </div>

      <p class="disclaimer">
        <strong>Note:</strong> The mNAV ratio indicates how the market values a company relative to the net asset value of its Ethereum treasury. A ratio above 1 suggests that the stock trades at a premium to the value of its ETH holdings, while a ratio below 1 indicates a discount. These values may change throughout the trading day.
      </p>

      <!-- Last updated timestamp will be populated by the script -->
      <p id="last-updated" style="font-size: 0.9rem; color: #555; margin-top: 0.5rem;">Last updated: —</p>
      <!-- Refresh now button -->
      <button id="refresh-button">Refresh now</button>
    </div>
    <footer>
      Data sources include publicly available disclosures and news reports, such as Blockworks【435112548905025†L64-L67】, MarketBeat【170830450899214†L339-L352】 and CoinCentral【258617695965557†L333-L352】. Values are refreshed hourly via GitHub Actions using the Financial Modeling Prep and CoinGecko APIs.
    </footer>

    <script>
      // Static holdings and shares based on latest disclosures
      const HOLDINGS = {
        bmnr: { eth: 1_523_373, shares: 173_496_950 }, // ETH and shares for BMNR【435112548905025†L64-L67】【473954857236543†L794-L797】
        sbet: { eth: 740_760,  shares: 24_000_000 }, // ETH and shares for SBET【258617695965557†L333-L352】
      };

      // DOM references
      const els = {
        bmnr: {
          price: document.getElementById('bmnr-price'),
          mnav:  document.getElementById('bmnr-mnav'),
          eth:   document.getElementById('bmnr-eth'),
        },
        sbet: {
          price: document.getElementById('sbet-price'),
          mnav:  document.getElementById('sbet-mnav'),
          eth:   document.getElementById('sbet-eth'),
        },
        updated: document.getElementById('last-updated'),
      };

      function fmtUSD(n) {
        return n == null ? '—' : `$${Number(n).toFixed(2)}`;
      }
      function fmtETH(n) {
        return n == null ? '—' : n.toLocaleString();
      }
      function fmtMNAV(n) {
        return n == null || !isFinite(n) ? '—' : Number(n).toFixed(2);
      }

      async function loadFromJson() {
        try {
          const res = await fetch('./data/prices.json', { cache: 'no-store' });
          const data = await res.json();
          const ethUsd = data?.eth?.usd ?? null;
          const bmnrPrice = data?.bmnr?.price ?? null;
          const sbetPrice = data?.sbet?.price ?? null;
          // Update price displays
          els.bmnr.price.textContent = fmtUSD(bmnrPrice);
          els.sbet.price.textContent = fmtUSD(sbetPrice);
          // ETH holdings are static
          els.bmnr.eth.textContent = fmtETH(HOLDINGS.bmnr.eth) + ' ETH';
          els.sbet.eth.textContent = fmtETH(HOLDINGS.sbet.eth) + ' ETH';
          // Compute mNAV values if all numbers present
          const bmnrMnav = bmnrPrice && ethUsd ? (bmnrPrice * HOLDINGS.bmnr.shares) / (HOLDINGS.bmnr.eth * ethUsd) : null;
          const sbetMnav = sbetPrice && ethUsd ? (sbetPrice * HOLDINGS.sbet.shares) / (HOLDINGS.sbet.eth * ethUsd) : null;
          els.bmnr.mnav.textContent = fmtMNAV(bmnrMnav);
          els.sbet.mnav.textContent = fmtMNAV(sbetMnav);
          // Last updated timestamp from JSON or current time
          const updated = data?.updated_at ? new Date(data.updated_at) : new Date();
          els.updated.textContent = 'Last updated: ' + updated.toUTCString();
        } catch (e) {
          console.error('Failed to load data/prices.json', e);
          els.updated.textContent = 'Last updated: — (failed to load data)';
        }
      }

      document.getElementById('refresh-button').addEventListener('click', () => {
        loadFromJson();
      });

      // Initial load and periodic refresh every hour
      loadFromJson();
      setInterval(loadFromJson, 60 * 60 * 1000);
    </script>
  </body>
</html>
